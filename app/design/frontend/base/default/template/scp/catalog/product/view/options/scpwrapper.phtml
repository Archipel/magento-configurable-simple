<fieldset class="product-options" id="product-options-wrapper">
    <?php echo $this->getChildHtml('', true, true);?>
    <span style="display:none;" class="scp-please-wait"><img src="<?php echo $this->getSkinUrl('images/scp/scp-ajax-loader.gif') ?>" class="v-middle" alt="" /> &nbsp; <?php echo $this->__('Loading...') ?> &nbsp;</span>
    <?php // add placeholder div for any ajax-loaded custom options ?>
    <div id="SCPcustomOptionsDiv"></div>
    <?php if ($this->hasRequiredOptions()):?>
        <p class="required"><?php echo $this->__('* Required Fields') ?></p>
    <?php endif;?>
</fieldset>

<script type="text/javascript">
	var nextbtn = jQuery('<a href="#" class="button nextbutton">Volgende</a>');
	nextbtn.click(nextoption);

    Object.extend(Validation, {
	    isVisible : function(elm) {
	        while(elm.tagName != 'BODY') {
	            if(!$(elm).visible()){
		            var jelm = jQuery(elm);
		            if(jelm.hasClass("super-attribute-select")){
			            var next = jelm.next();
			            if(next.hasClass('validation-advice')){
				            next = next.next();
			            }
			            if(next.is(':visible') && next.hasClass('image_picker_selector')){
				            return true;
			            }
		            }
	            	return false;
	            }
	            elm = elm.parentNode;
	        }
	        return true;
	    },
    });
    
	jQuery("select.super-attribute-select, select.product-custom-option").bind("change", nextoption);

    var dds = jQuery(".product-options dd");
    var dts = jQuery(".product-options dt");
    dds.hide();
    dts.addClass("collapsed");
    jQuery(dts[0]).removeClass("collapsed");
    jQuery(dds[0]).append(nextbtn)
    jQuery(dds[0]).show();

    function scpWewewoPriceReload(){
		    var prices = opConfig.reloadPrice();
   		 	if(typeof(productDesignGetExtraPrice) != 'undefined'){
	   		    var pdp = productDesignGetExtraPrice();
	   		    if(pdp > 0){
		   		    for(var i = 0 ; i < prices.length; i++){
			   		    prices[i].incl += pdp * prices[i].incl / prices[i].excl;
			   		    prices[i].price += pdp * prices[i].price / prices[i].excl;
			   		    prices[i].excl += pdp;
		   		    }
	   		    }
   		 	}
   		    if(typeof(applySizePrice) != 'undefined'){
	   			prices = applySizePrice(prices);
   		    }
			jQuery('.price-box').find(".regular-price .price").html(optionsPrice.formatPrice(prices[0].price));
			jQuery('.price-box').find(".price-including-tax .price").html(optionsPrice.formatPrice(prices[0].incl));
			jQuery('.price-box').find(".price-excluding-tax .price").html(optionsPrice.formatPrice(prices[0].excl));
   		    for(var i = 1 ; i < prices.length; i++){
	   		    if(prices[i].excl != prices[0].excl){
	   				jQuery('.price-box').find(".old-price .price").html(optionsPrice.formatPrice(prices[i].excl));
	   		    }
   		    }
   		    updateTotalPrice(prices);
    		jQuery("#selected_product .ajaxcontent").html("Some product details to be fetched from server");
    }

    function nextoption(){
    	if(productAddToCartForm.validator.validate()){

    	    var dds = jQuery(".product-options dd");
    	    var dts = jQuery(".product-options dt");
    	    var i = 0;
    	    for(;i < dds.length; i++){
        	    if(jQuery(dds[i]).is(":visible")){
            	    continue;
        	    }
        	    else{
        	    	jQuery(dds[i]).show();
        	        jQuery(dds[i]).append(nextbtn);
        	        jQuery(dts[i]).removeClass("collapsed");
            	    break;
        	    }
    	    }

        	if(i == dds.length){
        		nextbtn.hide();
    	    	jQuery("#choice_qty_price").show();
    	    	jQuery(".super-attribute-select").unbind("change", nextoption);
        	}
    	}
    	return false;
    }
    
    jQuery(document).ready(function(){
	    jQuery("#product_addtocart_form").on("change", scpWewewoPriceReload);
    });
</script>
